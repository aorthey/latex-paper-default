\usepackage{pgfkeys}
\pgfkeys{
/drawCapsule/.is family, /drawCapsule,
default/.style={line width = 1pt, color=black!30},
line width/.estore in = \linewidthC,
color/.estore in = \colorC,
}
\newcommand\drawCapsule[4][]{

        \pgfkeys{/drawCapsule, default, #1}
        \coordinate (A) at #2;
        \coordinate (B) at #3;
        \def\radius{#4}

        \coordinate (V1) at  ($(B)!\radius!-90:(A)$);
        \coordinate (V2) at  ($(A)!\radius!90:(B)$);
        \coordinate (V1P) at ($(B)!\radius!90:(A)$);
        \coordinate (V2P) at ($(A)!\radius!-90:(B)$);

        \draw[color=\colorC, line width = \linewidthC, #1] (A) circle (\radius);
        \draw[color=\colorC, line width = \linewidthC, #1] (B) circle (\radius);
        \draw[color=white,fill=white,line width=0pt] (V1) -- (V2) -- (V2P) -- (V1P) -- cycle;

        %\draw[color=white,fill=white,line width=2pt,shorten <= \linewidthCC, shorten >= \linewidthCC] (V1) -- (V1P);
        %\draw[color=white,fill=white,line width=2pt,shorten <= \linewidthCC, shorten >= \linewidthCC] (V2) -- (V2P);
        \draw[fill=\colorC,color=\colorC,shorten >= -\linewidthC, shorten <=
        -\linewidthC, line width = \linewidthC, #1] (V1) -- (V2);
        \draw[fill=\colorC,color=\colorC,shorten >= -\linewidthC, shorten <=
        -\linewidthC, line width = \linewidthC, #1] (V1P) -- (V2P);

        %%% draw middle points of each circle

        \draw[fill=\colorC,color=\colorC] (A) circle (1pt);
        \draw[fill=\colorC,color=\colorC] (B) circle (1pt);

}
